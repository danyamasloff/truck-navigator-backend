# Truck Navigator - Аналитическая система для грузоперевозок

Проект представляет собой бэкенд для аналитической подсистемы автоматизированной системы управления (АСУ) грузовыми автомобильными перевозками в России.

## Описание

Система функционирует как продвинутый навигатор/помощник для водителей и диспетчеров грузовиков, предоставляя уникальные аналитические возможности:

- **Продвинутая маршрутизация для грузовиков**:
    - Построение оптимальных маршрутов с учетом габаритов, веса, типа груза
    - Использование данных OpenStreetMap (OSM) для РФ

- **Предиктивный анализ состояния маршрута и груза**:
    - Прогноз рисков на маршруте
    - Учет качества дорожного покрытия, рельефа местности, статистики ДТП, погодных условий
    - Оценка риска адаптируется под тип и чувствительность груза

- **Динамический расчет рентабельности рейса**:
    - Расчет предполагаемой и фактической стоимости поездки в реальном времени
    - Учитываются динамические цены на топливо, стоимость платных дорог, износ ТС, стоимость рабочего времени водителя

- **Проактивный Комплаенс-Ассистент**:
    - Контроль Режима Труда и Отдыха (РТО) водителя
    - Динамический контроль весогабаритных ограничений
    - Учет требований к перевозке специфических грузов

## Технологический стек

- **Бэкенд**: Java 17, Spring Boot 3.4
- **База данных**: PostgreSQL с расширением PostGIS
- **Маршрутизация**: GraphHopper
- **Окружение/Развертывание**: Docker, Docker Compose
- **Внешние данные**: OpenWeatherMap API и другие API

## Структура проекта

```
ru.maslov.trucknavigator
├── config                 # Конфигурационные классы
├── controller             # REST контроллеры
├── dto                    # Объекты передачи данных
├── entity                 # Сущности JPA/Hibernate
├── exception              # Обработка исключений
├── integration            # Интеграция с внешними сервисами
│   ├── graphhopper        # Интеграция с GraphHopper
│   ├── openweather        # Интеграция с OpenWeatherMap
│   └── fuelprice          # Интеграция с сервисом цен на топливо
├── repository             # Репозитории данных
├── security               # Настройки безопасности
├── service                # Сервисы бизнес-логики
│   ├── impl               # Реализации сервисов
│   └── mapper             # Маппинг между DTO и сущностями
└── util                   # Утилитные классы
```

## Основные функциональности

### 1. Построение маршрутов с учетом специфики грузовиков

```
GET /api/routes/calculate
```

Построение маршрута с учетом параметров транспортного средства, груза и ограничений.

### 2. Анализ рисков маршрута

Система анализирует:
- Погодные риски
- Качество дорожного покрытия
- Специфические риски для типа груза
- Профиль рисков для конкретного ТС

### 3. Расчет экономики рейса

- Расчет затрат на топливо с учетом реальных цен
- Расчет стоимости платных дорог
- Учет затрат на оплату труда водителя
- Прогноз износа ТС

### 4. Контроль режима труда и отдыха

```
POST /api/drivers/{driverId}/analyze-rest-time
```

Анализ соответствия графика движения нормативам РТО и формирование рекомендаций по остановкам.

## Запуск проекта

### Предварительные требования

- Docker и Docker Compose
- JDK 17 или выше
- Maven

### Через Docker Compose

1. Клонирование репозитория:
   ```
   git clone https://github.com/yourusername/truck-navigator-backend.git
   cd truck-navigator-backend
   ```

2. Создание файла `.env` на основе примера:
   ```
   cp .env.example .env
   ```

3. Скачивание файла OSM для региона:
   ```
   mkdir -p osm-data
   wget -O osm-data/central-fed-district-latest.osm.pbf https://download.geofabrik.de/russia/central-fed-district-latest.osm.pbf
   ```

4. Сборка и запуск:
   ```
   mvn clean package -DskipTests
   docker-compose up -d
   ```

5. Проверка доступности API:
   ```
   http://localhost:8080/swagger-ui.html
   ```

### Без Docker

1. Установка PostgreSQL с PostGIS
2. Настройка GraphHopper
3. Настройка файла `application-dev.properties`
4. Запуск приложения:
   ```
   mvn spring-boot:run -Dspring-boot.run.profiles=dev
   ```

## Документация API

Документация API доступна по адресу `/swagger-ui.html` при запущенном приложении.

## Лицензия

Проект распространяется под лицензией MIT.